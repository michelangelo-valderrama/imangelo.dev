function h(e){const t=_(e),s=new ArrayBuffer(t.length),r=new DataView(s);for(let a=0;a<s.byteLength;a++)r.setUint8(a,t.charCodeAt(a));return s}const O="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function _(e){e.length%4===0&&(e=e.replace(/==?$/,""));let t="",s=0,r=0;for(let a=0;a<e.length;a++)s<<=6,s|=O.indexOf(e[a]),r+=6,r===24&&(t+=String.fromCharCode((s&16711680)>>16),t+=String.fromCharCode((s&65280)>>8),t+=String.fromCharCode(s&255),s=r=0);return r===12?(s>>=4,t+=String.fromCharCode(s)):r===18&&(s>>=2,t+=String.fromCharCode((s&65280)>>8),t+=String.fromCharCode(s&255)),t}const w=-1,C=-2,b=-3,m=-4,U=-5,D=-6;function P(e,t){return L(JSON.parse(e),t)}function L(e,t){if(typeof e=="number")return a(e,!0);if(!Array.isArray(e)||e.length===0)throw new Error("Invalid input");const s=e,r=Array(s.length);function a(n,f=!1){if(n===w)return;if(n===b)return NaN;if(n===m)return 1/0;if(n===U)return-1/0;if(n===D)return-0;if(f)throw new Error("Invalid input");if(n in r)return r[n];const o=s[n];if(!o||typeof o!="object")r[n]=o;else if(Array.isArray(o))if(typeof o[0]=="string"){const i=o[0],u=t?.[i];if(u)return r[n]=u(a(o[1]));switch(i){case"Date":r[n]=new Date(o[1]);break;case"Set":const y=new Set;r[n]=y;for(let c=1;c<o.length;c+=1)y.add(a(o[c]));break;case"Map":const A=new Map;r[n]=A;for(let c=1;c<o.length;c+=2)A.set(a(o[c]),a(o[c+1]));break;case"RegExp":r[n]=new RegExp(o[1],o[2]);break;case"Object":r[n]=Object(o[1]);break;case"BigInt":r[n]=BigInt(o[1]);break;case"null":const R=Object.create(null);r[n]=R;for(let c=1;c<o.length;c+=2)R[o[c]]=a(o[c+1]);break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":{const c=globalThis[i],E=o[1],T=h(E),I=new c(T);r[n]=I;break}case"ArrayBuffer":{const c=o[1],E=h(c);r[n]=E;break}default:throw new Error(`Unknown type ${i}`)}}else{const i=new Array(o.length);r[n]=i;for(let u=0;u<o.length;u+=1){const y=o[u];y!==C&&(i[u]=a(y))}}else{const i={};r[n]=i;for(const u in o){const y=o[u];i[u]=a(y)}}return r[n]}return a(0)}const g={actionName:"_astroAction",actionPayload:"_astroActionPayload",actionRedirect:"_astroActionRedirect"},k=g,N={BAD_REQUEST:400,UNAUTHORIZED:401,FORBIDDEN:403,NOT_FOUND:404,TIMEOUT:405,CONFLICT:409,PRECONDITION_FAILED:412,PAYLOAD_TOO_LARGE:413,UNSUPPORTED_MEDIA_TYPE:415,UNPROCESSABLE_CONTENT:422,TOO_MANY_REQUESTS:429,CLIENT_CLOSED_REQUEST:499,INTERNAL_SERVER_ERROR:500},F=Object.entries(N).reduce((e,[t,s])=>({...e,[s]:t}),{});class l extends Error{type="AstroActionError";code="INTERNAL_SERVER_ERROR";status=500;constructor(t){super(t.message),this.code=t.code,this.status=l.codeToStatus(t.code),t.stack&&(this.stack=t.stack)}static codeToStatus(t){return N[t]}static statusToCode(t){return F[t]??"INTERNAL_SERVER_ERROR"}static fromJson(t){return B(t)?new j(t.issues):v(t)?new l(t):new l({code:"INTERNAL_SERVER_ERROR"})}}function v(e){return typeof e=="object"&&e!=null&&"type"in e&&e.type==="AstroActionError"}function B(e){return typeof e=="object"&&e!=null&&"type"in e&&e.type==="AstroActionInputError"&&"issues"in e&&Array.isArray(e.issues)}class j extends l{type="AstroActionInputError";issues;fields;constructor(t){super({message:`Failed to validate: ${JSON.stringify(t,null,2)}`,code:"BAD_REQUEST"}),this.issues=t,this.fields={};for(const s of t)if(s.path.length>0){const r=s.path[0].toString();this.fields[r]??=[],this.fields[r]?.push(s.message)}}}function M(e){return`?${new URLSearchParams({[g.actionName]:e}).toString()}`}function S(e){if(e.type==="error"){let t;try{t=JSON.parse(e.body)}catch{return{data:void 0,error:new l({message:e.body,code:"INTERNAL_SERVER_ERROR"})}}return{error:l.fromJson(t),data:void 0}}return e.type==="empty"?{data:void 0,error:void 0}:{data:P(e.body,{URL:t=>new URL(t)}),error:void 0}}const $="%2E";function d(e={},t=""){return new Proxy(e,{get(s,r){if(r in s||typeof r=="symbol")return s[r];const a=t+encodeURIComponent(r.toString()).replaceAll(".",$);function n(f){return p(f,a)}return Object.assign(n,{queryString:M(a),toString:()=>n.queryString,$$FORM_ACTION:function(){const f=new URLSearchParams(n.toString());return f.set(k.actionRedirect,"false"),{method:"POST",name:"_astroAction",action:"?"+f.toString()}},async orThrow(f){const{data:o,error:i}=await p(f,a);if(i)throw i;return o}}),d(n,a+".")}})}async function p(e,t,s){const r=new Headers;r.set("Accept","application/json");let a=e;if(!(a instanceof FormData)){try{a=JSON.stringify(e)}catch(f){throw new l({code:"BAD_REQUEST",message:`Failed to serialize request body to JSON. Full error: ${f.message}`})}a?r.set("Content-Type","application/json"):r.set("Content-Length","0")}const n=await fetch(`${"/".replace(/\/$/,"")}/_actions/${t}`,{method:"POST",body:a,headers:r});return n.status===204?S({type:"empty",status:204}):S({type:n.ok?"data":"error",body:await n.text()})}const V=d();export{V as a};
