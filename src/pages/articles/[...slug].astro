---
import type { GetStaticPaths } from 'astro'
import type { CollectionEntry } from 'astro:content'
import { Image } from 'astro:assets'

import { getFilteredPosts } from '@/lib/utils'

import Root from '@/layouts/Root.layout.astro'
import Main from '@/layouts/Main.layout.astro'
import Markdown from '@/layouts/Markdown.layout.astro'

import BackLink from '@/components/widgets/BackLink.astro'

import Link from '@/components/ui/link'

export const getStaticPaths = (async () => {
  const articles = await getFilteredPosts('articles')

  return articles.map((article) => ({
    params: { slug: article.slug },
    props: { article }
  }))
}) satisfies GetStaticPaths

interface Props {
  article: CollectionEntry<'articles'>
}

const { article } = Astro.props
const { Content } = await article.render()

const {
  data: { title, pubDate, lastModDate, category, tags, cover }
} = article

const modDate = (lastModDate ?? pubDate).toLocaleDateString('es-ES', {
  day: '2-digit',
  month: 'short',
  year: 'numeric'
})
---

<Root>
  <Main>
    <header class="mb-8">
      <BackLink />
      <h1 class="text-xl font-medium line-height-tight mb-1 mt-2 text-header">
        El principio del universo: Desde las partículas hasta las estrellas
      </h1>
      <time class="text-sm text-muted-foreground" datetime="2024-09-01"
        >21 sep, 2024</time
      >
      {!cover ? null : <Image {...cover} alt={title} class="mt-6" />}
    </header>
    <Markdown class="pb-24">
      <Content />
      <aside
        class="relative w-screen left-1/2 right-1/2 -ml-50vw -mr-50vw border-t border-b py-8 mt-18 bg-muted"
      >
        <div class="max-w-screen-xs px-4 ma">
          <p>Gracias por leer :></p>
          <p>
            Recuerda suscribirte a mi <a href="/rss">RSS</a> o <a
              href="/newsletter">newsletter</a
            > para estar atento a mis futuras divagaciones.
          </p>
          <p class="text-sm! text-foreground/70! mt-8!">
            Un saludo.<br />— Michelangelo
          </p>
        </div>
      </aside>
    </Markdown>
    <footer>
      <h2 class="font-medium mb-4">Sobre este artículo</h2>
      <ul
        class="*:flex *:items-center *:justify-between space-y-2 text-muted-foreground text-sm"
      >
        {
          cover?.credits && (
            <li>
              <span class="pr-4">Imagen</span>
              <span class="text-foreground line-clamp-1 text-right">
                {cover!.credits}
              </span>
            </li>
          )
        }
        <li>
          <span class="pr-4">Publicado en</span>
          <span class="text-foreground text-right">
            <Link className="text-foreground" href={'/categories/' + category}
              >{category}</Link
            >
          </span>
        </li>
        <li>
          <span class="pr-4">Etiquetas</span>
          <span class="text-foreground flex gap-3 text-right">
            {
              tags.map((tag) => (
                <Link className="text-foreground" href={'/categories/' + tag}>
                  {tag}
                </Link>
              ))
            }
          </span>
        </li>
        <li>
          <span class="pr-4">Actualizado el</span>
          <time class="text-foreground text-right" datetime={modDate}
            >{modDate}</time
          >
        </li>
      </ul>
    </footer>
  </Main>
</Root>
